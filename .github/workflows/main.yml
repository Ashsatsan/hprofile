name: Workflow for the project
on: [workflow_dispatch, push]
jobs:
  Testing:
     runs-on: ubuntu-latest
     steps:
        - name: Checkout for source code 
          uses: actions/checkout@v4

        - name: Java setup JDK
          uses: actions/setup-java@v4
          with:
             distribution: 'temurin' # See 'Supported distributions' for available options
             java-version: '11'

        - name: Maven test 
          run: mvn test

        - name: Checkstyle Analysis
          run: mvn checkstyle:checkstyle 

        - name: Setup SonarQube
          uses: warchant/setup-sonar-scanner@v7

        - name: Analyze with SonarCloud
          run: sonar-scanner
            -Dsonar.host.url=${{ secrets.SONAR_URL }}
            -Dsonar.token=${{ secrets.TOKEN }}
            -Dsonar.organization=${{ secrets.SONAR_ORGANIZATION }}
            -Dsonar.projectKey=${{ secrets.SONAR_PROJECT_KEY }}
            -Dsonar.sources=src/
            -Dsonar.junit.reportPaths=target/surefire-reports/
            -Dsonar.jacoco.reportsPath=target/jacoco.exec 
            -Dsonar.java.checkstyle.reportPaths=target/checkstyle-result.xml
            -Dsonar.java.binaries=target/test-classes/com/visualpathit/account/controllerTest/

        - name: SonarQube Quality Gate check
          id: sonarqube-quality-gate-check
          uses: sonarsource/sonarqube-quality-gate-action@master
            # Force to fail step after specific time.
          timeout-minutes: 5
          env:
             SONAR_TOKEN: ${{ secrets.TOKEN }}
             SONAR_HOST_URL: ${{ secrets.SONAR_URL }}                                   